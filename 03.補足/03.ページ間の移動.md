一般的な Web サイトや Web アプリは、複数の異なるページを持つことができる。

- ファイルシステムルーティングという特徴
- Link コンポーネントを使って、クライアントサイドのページ遷移を実現する
- コード分割とプリフェッチングに関するビルトインのサポート

<br />

# Next.js におけるページ

Next.js では、ページとは pages ディレクトリに存在するファイルからエクスポートされる React コンポーネント。

ページは ファイル名 に基づいてルーティングに関連づけられる。例えば、開発時は：

- pages/index.js は `/` にルーティングされる。
- pages/posts/first-post.js は `/posts/first-post` としてルーティングされる。

<br />

# 新しいページを作成する

```zsh
$ mkdir pages/posts
```

first-post.js

```jsx
export default function FirstPost() {
  return <h1>First Post</h1>;
}
```

コンポーネントはどんな名前でもいいが、必ず default エクスポートする必要がある。

http://127.0.0.1:3000/posts/first-post

これが、Next.js において異なるページを作成する方法。

pages ディレクトリの配下にシンプルに JavaScript ファイルを作成すれば、そのファイルへのパスが URL のパスになる。  
ある意味、HTML や PHP のファイルを使って Web サイトを構築するのと似てる。HTML を書く代わりに JSX を書き、 React コンポーネントを使う。

<br />

# Link コンポーネント

Web サイトのページ間でリンクを貼るときは一般的には \<a> という HTML タグが使われる。

Next.js では、\<Link> という、 \<a> タグをラップした React コンポーネントを使う。\<Link> によって、アプリ内の異なるページへクライアントサイドで遷移することができる。

## \<Link> を使う

まず、pages/index.js 内で、以下の行を一番上に加えて、 next/link から Link コンポーネントをインポートする。

```jsx
import Link from 'next/link';
```

そうしたら、h1 タグ内に存在する以下の行を適当なところに追記する。

```jsx
<Link href='/posts/first-post'>
  <a>this page!</a>
</Link>
```

次に、pages/posts/first-post.js の内容を以下のように書き換える。

```jsx
import Link from 'next/link';

export default function FirstPost() {
  return (
    <>
      <h1>First Post</h1>
      <h2>
        <Link href='/'>
          <a>Back to home</a>
        </Link>
      </h2>
    </>
  );
}
```

見てのとおり、Link コンポーネントは \<a> タグを使うのと似ている。\<a href="..."> の代わりに \<Link href="..."> を使い、その中に \<a> タグを配置する。

<br />

# クライアントサイドのページ遷移（ナビゲーション）

Link コンポーネントによって、同じ Next.js アプリ内にある 2 つのページ間のクライアントサイドでのナビゲーションが可能になる。

クライアントサイドのナビゲーションとは、ページ遷移が JavaScript を使って 行われることを意味し、ブラウザによって行われるデフォルトのページ遷移よりも高速。

ブラウザがページ全体をロードしているのではなく、クライアントサイドでのナビゲーション（ページ遷移）が機能する。

もし \<Link href="..."> でなく \<a href="..."> を使って上記と同様のことを行ったら、リンクをクリックするとブラウザはページ全体をリフレッシュする。

<br />

# コード分割とプリフェッチング

Next.js は自動的にコード分割を行うので、各ページはそのページに必要なものだけを読み込む。つまり、トップのページがレンダリングされたときに、他のページのコードが最初からサーブされるわけではないということ。

このことにより、たとえ数百ものページを持つアプリであってもトップページは素早く読み込まれることが保証される。

リクエストしたページのコードだけを読み込むということは、ページが分離されるということでもある。あるページでエラーが発生したとしても、アプリの他の部分は動作し続ける。

さらに、（開発時のビルドでなく）本番環境でのビルドにおいては、Link コンポーネントがブラウザのビューポートに表示されると、Next.js は`自動的にリンク先のページのコードをバックグラウンドでプリフェッチする。`リンクをクリックするときまでには、目的のページのコードはバックグラウンドで読み込まれ終わっており、`ページ遷移はほぼ瞬時に行われる！`

Next.js は、コード分割、クライアントサイドのナビゲーション、（本番環境における）プリフェッチングによって、最良のパフォーマンスのためにアプリを`自動的に最適化する。`

メモ：  
Next.js のアプリの外にある外部のページにリンクを貼る必要があるときは、 Link 無しで \<a> タグだけを使うこと。  
className といった属性を加える必要があるときは、 Link タグでなく、a タグに加えること。
